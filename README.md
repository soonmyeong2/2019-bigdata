Recommend location of accommodation in Seoul
=======

![그림1](https://user-images.githubusercontent.com/38336997/59963216-d66acf80-952a-11e9-9545-5500e104b32c.png)



## Project 

이 프로젝트는 서울특별시 숙박업에 유리한 입지 조건을 가진 위치를 공시지가, 숙박 시설 분포 현황, 생활 인구, 주민등록인구 데이터 자료를 기반으로 분석하여 행정동 단위로 추천한다. </br>

## Installing

```
$ git clone https://github.com/philjjoon/2019-1-GROUP-1
$ cd 2019-1-GROUP-1
$ pip install -r requirements.txt    # for processing
$ cd visual/code
$ npm install                        # for visualization
```

## Running

* data processing
```
spark-submit anaysis/{}.py
```

* visualization
```
$ node index.js
```

## Data Processing
#### Data Acquisition (5.2GB)
 
1. 서울특별시 숙박시설 등록 현황</br>
  19년 5월 10일 등록 기준 서울열린데이터광장 제공
  [(Download Link)](https://data.seoul.go.kr/dataList/datasetView.do?infId=OA-15117&srvType=S&serviceKind=1&currentPageNo=1)
  
2. 서울특별시 부동산 공시지가 정보</br>
  14년부터 18년까지 5개년 데이터. 서울열린데이터광장 제공
    [(Download Link)](https://data.seoul.go.kr/dataList/datasetView.do?infId=OA-15551&srvType=S&serviceKind=1&currentPageNo=1)
   
3) 서울특별시 행정동별 생활인구 **(장기체류 외국인, 단기체류 외국인, 내국인)**</br>
  17년 1월부터 19년 3월까지 데이터. 서울열린데이터광장 제공 [(Download Link)](https://data.seoul.go.kr/search/newSearch.jsp)
  
4) 서울시 주민등록인구 행정동별 통계 </br>
  17년, 18년, 19년 1/4분기의 데이터. 서울열린데이터광장에 제공 [(Download Link)](https://data.seoul.go.kr/dataList/datasetView.do?infId=10043&srvType=S&serviceKind=2)
  
#### Data Analysis
1) 서울특별시 숙박시설 등록 현황 </br>
  숙박업소의 주소가 도로명으로 되어 있으므로 행정동으로 변환 하기 위하여, Daum map API를 이용하여 해당 주소의 좌표와 행정동의 범위를 이용하여 해당 숙박업소가 속한 행정동 코드를 반환하여 행정동 코드를 얻음
각 행정동 마다의 숙박 업소의 수용인구를 알 수 있도록, 행정동 안에 존재하는 객실 수를 구한다.
2) 서울특별시 부동산 공시지가 정보 최근 5개년 (14년~18년) </br>
  `공시지가의 지번 코드 = 법정동(10자리) + 지번구분 (1자리) + 본번(4자리) + 부번(4자리)`로 구성되어 있으므로 법정동과 지번 본번의 조합으로 해당 주소를 찾고, Daum map API를 이용하여 해당 부지가 속하는 행정동을 알아낸다.
이후 각 행정동 마다의 지가 평균을 구한다.
3) 단기 체류 외국인 생활인구 최근 3개년(17년 1월 ~ 19년 3월) </br>
  생활인구 데이터는 시간별, 날짜별, 행정동별로 나뉘어져있기 때문에, 행정동의 평균을 구한다. 
  ![12](https://user-images.githubusercontent.com/38336997/59964067-a45f6a80-9536-11e9-93ca-1985db66bd64.png)
  <p align="center"><그림 1> &nbsp; x축 : 행정동 코드 &nbsp;  | &nbsp; &nbsp;   y축 : 단기 체류 외국인 수</p>
	
  
  </br> <p align="center"> ![13](https://user-images.githubusercontent.com/38336997/59964068-a6292e00-9536-11e9-8c40-15590b986a25.png) </p>
  <p align="center">그림 1.의 결과를 heat map으로 표현 한 뒤 상위 10개 관광지 표시</p>
 										서울시 외국인 방문객이 많이 가는 관광명소와, 행정동 별 외국인 관광객 수를 함께 지도위에 띄우면 다음과 같다. 색이 붉을수록 생활인구가 많은 것으로, 대부분의 관광명소와 일치하는 것을 알 수 있다. 따라서 본 프로젝트는 단기 체류 외국인 생활인구 데이터를 이용하여 각 행정동에 가중치를 준다. 

4) 장기 체류 외국인 생활인구 최근 3개년(17년 1월 ~ 19년 3월)</br>
날짜와 시간대를 aggregate한 뒤 행정동의 평균을 구한다.

5) 내국인 생활인구 최근 3개년(17년 1월 ~ 19년 3월)</br>
서울특별시의 경우 일단위로 분석하였을 때, 유입인구가 유출인구보다 훨씬 많다. 이 유입인구의 원인은 출근 또는 등교 등으로 인한 통근자 또는 통학자에 기인한 것으로 보인다. 그러나 그 사람들은 숙박업소를 이용하지 않기 때문에, 데이터에서 제거하기 위하여 심야 생활 인구만을 사용한다.
</br> <p align="center"> ![ddddd](https://user-images.githubusercontent.com/38336997/59964311-15545180-953a-11e9-99a6-ef8a7fbfa6cc.JPG)</p> </br>
    표를 보면, 주중인 10시-14시와 심야인 02시-06시로 구간을 나누어 내국인과 외국인 생활인구와 비교했을때 생활인구가 크게 차이가 나는 것을 알 수 있다. 따라서 생활인구에서 심야 시간대인 02시-06시의 데이터만을 사용하고, 미성년자의 경우 숙박업소 이용이 불가능하기 때문에 미성년자 데이터 또한 제거한다.</br>
최종적으로 생활 인구 중 서울에 거주하는 사람들의 경우 그렇지 않은 사람에 비해 숙박 업소 이용 확률이 현저히 작기 때문에 서울시 행정동별 거주 인구를 빼준다. 이 결과 값이 높을수록 숙박업소 이용 확률이 높은 잠재 고객이 높다고 생각할 수 있다. 

6) 서울특별시시 주민등록인구 행정동별 통계 </br>
행정동별 주민등록 인구로 나누어 5.단계의 내국인 생활 인구 데이터에서 차감한다.



#### Our formula
![se](https://user-images.githubusercontent.com/38336997/59964313-171e1500-953a-11e9-8062-91c1b8ff9635.JPG)

숙박 업소의 최적의 입지를 찾기 위하여 위의 프로세싱 된 결과를 토대로 행정동 마다의 숙박업소에 미치는 여러 가지 속성들의 값을 추출 하였고 점수에 미치는 영향력이 다르기 때문의 각각의 가중치를 조정하였다. 가중치를 구하기 위해 텐서플로우를 사용하였으며 input data로 숙박업소에 미치는 속성인 `[공시지가, 단기외국인 인구, 장기와 내국인 인구]`를 각각 t1, t2, t3값으로 설정하였고 각각 min-max scaling을 하였다. 정답 값은 행정동단위 숙박가능한 방의 갯수로 하였는데, 이를 정답 값으로 둔 이유는 숙박업소의 분포도 수십년간 적용된 빅데이터이기 때문에 실제 잘될만한 곳에 분포되어있는 정답 값에 매우 수렴하기 때문이다. 

t4 값은 사용자 입력값으로 사용자의 성향인 재정적 상황이나, 지역적 선호도가 달라질 수 있기 때문에 조정 가능한 값으로 설정하였다. 이 산출식을 간단히 요약하면 **수요를 예측해보았을 때 공시지가가 저렴해 경쟁력이 있거나 숙박 업소보다 수요가 더 많이 예상되는 행정동에 높은 점수가 부여**된다 


## Visualization
 1. 행정동 경계 데이터 입력
 지도에 각 행정동을 다각형 형태로 표시하기 위해 행정 경계의 각 꼭짓점의 위경도 좌표가 저장된 데이터를 DB에 입력하였다.
 
 	https://github.com/vuski/admdongkor 
 
	위 저장소는 통계청 통계지리서비스에서 제공하는 행정동 경계 파일을 바탕으로 행정동 변경 이력을 수정하여 반영한 파일이다. 데이터는 geojson이라는 json 형식의 지형 표현 형식의 파일로 제공된다.
 2. 점수 데이터 입력
Analysis 과정에서 분석된 평균 공시지가, 내국인 생활인구, 단기체류 외국인 생활인구, 숙박업소 호실 수, 추천 점수를 입력한다.
3. 다음 지도 API 사용
</br> ![daum_map](https://user-images.githubusercontent.com/38336997/59964847-52701200-9541-11e9-996d-d29124cb7e3d.png) </br>
	다음 지도 API의 Web API를 사용하여 입력된 데이터를 Visualization 한다. 해당 API는 Javascript로 제공되며, 행정동 경계 데이터를 통해 행정동의 형태를 표시하고, 점수 데이터를 통해 색상을 지정한다.

#### API
API는 MVC 모델을 적용한 RESTful API로 작성하였다.

### 행정동 목록
```http
GET /adm_dongs
```

응답
```json5
[
  {
    "code": "1102417", // 국토부 행정동 코드(7자리)
    "code2": "1102417500", // 행정안전부 행정동 코드(10자리)
    "address": "서울특별시 사직구 번동", // 주소
    "t1": 0.15321, // Normalize된 공시지가 평균
    "t1_raw": 155481245 // 공시지가 평균 원/km²
    "t2": 0.55213, // Normalize된 생활인구 - 거주인구의 일 평균
    "t2_raw": 48651202011, // 생활인구 - 거주인구의 일 평균
    "f1": 0.55213, // Normalize된 2017년 1월 ~ 2019년 3월 단기체류 외국인 생활인구 총합
    "f1_raw": 48651202011, // 2017년 1월 ~ 2019년 3월 단기체류 외국인 생활인구 총합
    "t3": 0.6647, // Normalize된 숙박업소 호실 수
    "t3_raw": 45, // 숙박업소 호실 수
    "t3_expected": 0.9954, // 예상 숙박업소 호실 수
    "r": 0.3307 // 추천 점수(t3_expected - t3)
  },
  // ...
]
```

### 행정동 정보
```http
GET /adm_dongs/{code}
```
code: 국토부 행정동 코드

응답
```json5
{
  "code": "1102417", // 국토부 행정동 코드(7자리)
  "code2": "1102417500", // 행정안전부 행정동 코드(10자리)
  "address": "서울특별시 사직구 번동", // 주소
  "t1": 0.15321, // Normalize된 공시지가 평균
  "t1_raw": 155481245 // 공시지가 평균 원/km²
  "t2": 0.55213, // Normalize된 생활인구 - 거주인구의 일 평균
  "t2_raw": 48651202011, // 생활인구 - 거주인구의 일 평균
  "f1": 0.55213, // Normalize된 2017년 1월 ~ 2019년 3월 단기체류 외국인 생활인구 총합
  "f1_raw": 48651202011, // 2017년 1월 ~ 2019년 3월 단기체류 외국인 생활인구 총합
  "t3": 0.6647, // Normalize된 숙박업소 호실 수
  "t3_raw": 45, // 숙박업소 호실 수
  "t3_expected": 0.9954, // 예상 숙박업소 호실 수
  "r": 0.3307 // 추천 점수(t3_expected - t3)
}
```

## Demo

![ezgif com-gif-maker](https://user-images.githubusercontent.com/38336997/59966357-b3eeab80-9556-11e9-98c4-28365492fb44.gif)
